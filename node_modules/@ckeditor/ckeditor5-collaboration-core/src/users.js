/*
 *             Copyright (c) 2016 - 2020, CKSource - Frederico Knabben. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import _0xee249a from'@ckeditor/ckeditor5-core/src/contextplugin';import _0x461ef2 from'@ckeditor/ckeditor5-utils/src/collection';import'../theme/usercolors.css';import _0x4d6326 from'@ckeditor/ckeditor5-utils/src/ckeditorerror';export default class r extends _0xee249a{static get['pluginName'](){return'Users';}constructor(_0x6f4f33){super(_0x6f4f33),_0x6f4f33['config']['define']('users.anonymousUserId','anonymous-user'),_0x6f4f33['config']['define']('users.colorsCount',0x8),this['users']=new _0x461ef2(),this['_locale']=_0x6f4f33['locale'],this['_licenseKeyCheckInterval']=null,this['_lastColor']=0x0,this['_myId']=null,this['decorate']('getOperationAuthor');}['init'](){const _0x135cc2=this['context'];this['licenseKey']=_0x135cc2['config']['get']('licenseKey'),this['_licenseKeyCheckInterval']=setInterval(()=>{let _0x6be246;for(const _0x4962fc in _0x135cc2){const _0x437866=_0x135cc2[_0x4962fc];if('licenseKeyTrial'===_0x437866||'licenseKeyInvalid'===_0x437866||'licenseKeyValid'===_0x437866||'licenseKeyTrialLimit'==_0x437866){delete _0x135cc2[_0x4962fc],_0x6be246=_0x437866;break;}}if('licenseKeyInvalid'===_0x6be246)throw clearInterval(this['_licenseKeyCheckInterval']),new _0x4d6326('invalid-license-key',null);if('licenseKeyTrial'===_0x6be246&&console['info']('You\x20are\x20using\x20the\x20trial\x20version\x20of\x20CKEditor\x205\x20collaboration\x20plugin\x20with\x20limited\x20usage.\x20Make\x20sure\x20you\x20will\x20not\x20use\x20it\x20in\x20the\x20production\x20environment.'),'licenseKeyTrialLimit'===_0x6be246)throw clearInterval(this['_licenseKeyCheckInterval']),new _0x4d6326('trial-license-key-reached-limit',null);'licenseKeyValid'===_0x6be246&&clearInterval(this['_licenseKeyCheckInterval']);},0x3e8);}get['me'](){return null==this['_myId']?null:this['getUser'](this['_myId']);}['addUser'](_0x43ad5e){if(!(_0x43ad5e=Object['assign']({},_0x43ad5e,{'color':this['_getNextColor']()}))['id']||'string'!=typeof _0x43ad5e['id'])throw new _0x4d6326('users-add-invalid-id');if(this['users']['has'](_0x43ad5e['id']))throw new _0x4d6326('users-add-duplicated-id',null,{'id':_0x43ad5e['id']});_0x43ad5e['name']=function(_0x218ca8,_0x912ac0=''){const {t:t}=_0x218ca8;return''==(_0x912ac0=_0x912ac0['trim']())?t('Anonymous'):_0x912ac0;}(this['_locale'],_0x43ad5e['name']);const _0x57367d=new n(_0x43ad5e);return this['users']['add'](_0x57367d),_0x57367d;}['getUser'](_0x234937){return this['users']['get'](_0x234937);}['useAnonymousUser'](){const _0x43b3a4=this['context']['config']['get']('users.anonymousUserId'),{t:t}=this['_locale'];if(this['users']['has'](_0x43b3a4))return;this['addUser']({'id':_0x43b3a4,'name':t('Anonymous')})['_isAnonymous']=!0x0,this['defineMe'](_0x43b3a4);}['defineMe'](_0x4a49a9){if(this['_myId'])throw new _0x4d6326('users-me-already-defined',null);if(!this['getUser'](_0x4a49a9))throw new _0x4d6326('users-me-missing-user',null);this['_myId']=_0x4a49a9;}['getOperationAuthor'](){return this['me'];}['destroy'](){super['destroy'](),clearInterval(this['_licenseKeyCheckInterval']);}['_getNextColor'](){const _0x27d065=this['context']['config']['get']('users.colorsCount');return this['_lastColor']>=_0x27d065&&(this['_lastColor']=0x0),new o(this['_lastColor']++);}}class n{constructor(_0x3ca6e1){this['id']=_0x3ca6e1['id'],this['color']=_0x3ca6e1['color'],this['name']=_0x3ca6e1['name'],this['avatar']=_0x3ca6e1['avatar'],this['_isAnonymous']=!0x1;}get['isAnonymous'](){return this['_isAnonymous'];}get['initials'](){return this['name']['split']('\x20')['map'](_0x485285=>_0x485285['charAt'](0x0))['slice'](0x0,0x2)['join']('')['toUpperCase']();}}class o{constructor(_0x1810dc){this['_id']=_0x1810dc;}['getBackgroundColorClass'](){return'ck-user__bg-color--'+this['_id'];}['getSelectionClass'](){return'ck-user__selection--'+this['_id'];}['getMarkerClass'](){return'ck-user__marker--'+this['_id'];}}