/*
 *             Copyright (c) 2016 - 2020, CKSource - Frederico Knabben. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x5f9a=['editor','getAllMarkersForId','upcast','data','add','end','_handleMarkerAddAndRemove','getWalker','elementToElement','set','registerPostFixer','sort','removeCommentThread','rootName','split','markerName','managedUsingOperations','getAttribute','init','editingDowncast','isThreadsLoadingPaused','updateMarker','removeMarker','then','change','openNewCommentThread','map','push','listenTo','differ','markerToHighlight','addComment','_changedMarkers','markers','destroy','_threads','isEqual','$marker','for','_initializeMarkerConverters','isObject','requires','CommentsRepository','_attachThreadToMarker','start','model','getMarkersGroup','editing','collaboration.channelId','$graveyard','plugins','get','affectsData','top','newRange','config','render','length','getCommentThread','low','_attachedThreads','left','hasMarkerForId','state','document','text','conversion','dataToMarker','createRange','activeMarker','commands','once','attachTo','fetchCommentThread','update:comment','isCollapsed','CommentsEditing','comment:','name','comment','has','root','hasContent','delete','change:isThreadsLoadingPaused','from','addCommentThread','change:activeMarker','stop'];(function(_0x1c4551,_0x5f9a91){const _0x2e4198=function(_0x5cbbaf){while(--_0x5cbbaf){_0x1c4551['push'](_0x1c4551['shift']());}};_0x2e4198(++_0x5f9a91);}(_0x5f9a,0xda));const _0x2e41=function(_0x1c4551,_0x5f9a91){_0x1c4551=_0x1c4551-0x0;let _0x2e4198=_0x5f9a[_0x1c4551];return _0x2e4198;};import _0x2f7c82 from'@ckeditor/ckeditor5-core/src/plugin';import _0x254e60 from'@ckeditor/ckeditor5-utils/src/dom/rect';import _0x3b3b5c from'./commentsrepository';import _0x11a244 from'./addcommentthreadcommand';import _0x20068c from'../utils/getmarkerdomelement';import _0x431d67 from'./integrations/commentsrestrictededitingmode';import'../../theme/commentmarker.css';export default class r extends _0x2f7c82{static get[_0x2e41('0x1')](){return[_0x3b3b5c,_0x431d67];}static get['pluginName'](){return _0x2e41('0x24');}constructor(_0x94440b){super(_0x94440b),this[_0x2e41('0x3a')](_0x2e41('0x45'),!0x0),_0x94440b[_0x2e41('0x34')][_0x2e41('0x1f')]('ready',()=>this[_0x2e41('0x45')]=!0x1),this['set'](_0x2e41('0x1d'),null),this['on'](_0x2e41('0x2f'),(_0xf6ebd3,_0x4e6096,_0x2e0c2f,_0x457eab)=>{_0x94440b[_0x2e41('0x5')]['change'](_0x198e5c=>{if(_0x2e0c2f){const {id:_0x122105}=q(_0x2e0c2f),_0x5c34b3=this[_0x2e41('0x32')](_0x122105);for(const _0x11d5a7 of _0x5c34b3)_0x198e5c[_0x2e41('0x46')](_0x11d5a7);}if(_0x457eab){const {id:_0x19b695}=q(_0x457eab),_0x56bfad=this[_0x2e41('0x32')](_0x19b695);for(const _0x46bed9 of _0x56bfad)_0x198e5c[_0x2e41('0x46')](_0x46bed9);}});}),this[_0x2e41('0x14')]=new Set();}[_0x2e41('0x43')](){const _0x88df5e=this[_0x2e41('0x31')],_0x4a9ef9=_0x88df5e[_0x2e41('0xa')][_0x2e41('0xb')](_0x2e41('0x2')),_0x36805f=_0x88df5e['config'][_0x2e41('0xb')](_0x2e41('0x8'));_0x88df5e[_0x2e41('0x1e')][_0x2e41('0x35')](_0x2e41('0x2e'),new _0x11a244(_0x88df5e)),this[_0x2e41('0x4d')](_0x88df5e,'change:isReadOnly',(_0x12f1f3,_0x4bb284,_0x11ef04)=>{_0x4a9ef9['switchReadOnly'](_0x11ef04,_0x88df5e[_0x2e41('0xf')][_0x2e41('0xb')]('collaboration.channelId'));}),this[_0x2e41('0x4d')](_0x4a9ef9,F(_0x2e41('0x3d'),_0x36805f),(_0x4d91ed,{threadId:_0x10bfb1})=>{_0x88df5e['model'][_0x2e41('0x49')](_0x302089=>{for(const _0x2bf6ed of this[_0x2e41('0x32')](_0x10bfb1))_0x302089[_0x2e41('0x47')](_0x2bf6ed);});const _0x251a1f=_0x4a9ef9[_0x2e41('0x12')](_0x10bfb1);_0x4a9ef9['hasCommentThread'](_0x10bfb1)&&!_0x251a1f[_0x2e41('0x11')]||_0x4d91ed[_0x2e41('0x30')]();},{'priority':'high'}),this[_0x2e41('0x4d')](_0x4a9ef9,F(_0x2e41('0x50'),_0x36805f),(_0x5b90be,{threadId:_0x53a6d4,isFromAdapter:_0x45dac3})=>{const _0x2f8ed6=this[_0x2e41('0x32')](_0x53a6d4);if(_0x45dac3||0x0==_0x2f8ed6[_0x2e41('0x11')]||!_0x4a9ef9['hasCommentThread'](_0x53a6d4))return;0x1===_0x4a9ef9[_0x2e41('0x12')](_0x53a6d4)['length']&&_0x88df5e[_0x2e41('0x5')][_0x2e41('0x49')](_0x5722f5=>{for(const _0x29a4d7 of _0x2f8ed6)_0x5722f5[_0x2e41('0x46')](_0x29a4d7,{'usingOperation':!0x0,'affectsData':!0x0});});},{'priority':_0x2e41('0x13')}),this[_0x2e41('0x58')](),this[_0x2e41('0x37')]();}[_0x2e41('0x53')](){const _0x4444c0=this[_0x2e41('0x31')]['plugins'][_0x2e41('0xb')]('CommentsRepository'),_0x217a0f=this[_0x2e41('0x31')]['config'][_0x2e41('0xb')](_0x2e41('0x8'));for(const _0x364fbe of _0x4444c0['getCommentThreads']({'channelId':_0x217a0f}))_0x4444c0['_detachCommentThread'](_0x364fbe['id']),_0x4444c0[_0x2e41('0x54')][_0x2e41('0x2b')](_0x364fbe['id']);super['destroy']();}[_0x2e41('0x16')](_0x43b484){return this[_0x2e41('0x32')](_0x43b484)[_0x2e41('0x11')]>0x0;}['getAllMarkersForId'](_0x28836f){const _0x138c5b=this[_0x2e41('0x31')][_0x2e41('0x5')][_0x2e41('0x52')][_0x2e41('0xb')](_0x2e41('0x25')+_0x28836f);return _0x138c5b?[_0x138c5b]:Array[_0x2e41('0x2d')](this[_0x2e41('0x31')][_0x2e41('0x5')]['markers'][_0x2e41('0x6')](_0x2e41('0x25')+_0x28836f));}[_0x2e41('0x58')](){const _0x589561=this['editor'];_0x589561[_0x2e41('0x1a')]['for'](_0x2e41('0x44'))[_0x2e41('0x4f')]({'model':_0x2e41('0x27'),'view':_0x613754=>{const {id:_0x203bc9}=q(_0x613754[_0x2e41('0x40')]),_0x38771a=['ck-comment-marker'];return this['activeMarker']&&q(this[_0x2e41('0x1d')])['id']===_0x203bc9&&_0x38771a[_0x2e41('0x4c')]('ck-comment-marker--active'),{'classes':_0x38771a,'attributes':{'data-comment':_0x203bc9}};}}),_0x589561[_0x2e41('0x1a')]['for']('dataDowncast')['markerToData']({'model':_0x2e41('0x27'),'view':_0x54eadf=>{const _0x334237=_0x589561[_0x2e41('0x5')][_0x2e41('0x52')][_0x2e41('0xb')](_0x54eadf),{id:_0x4fe7ee,part:_0x371923}=q(_0x54eadf);return _0x334237[_0x2e41('0xc')]?{'group':'comment','name':_0x371923?_0x4fe7ee+':'+_0x371923:_0x4fe7ee}:null;}}),_0x589561[_0x2e41('0x1a')][_0x2e41('0x57')](_0x2e41('0x33'))[_0x2e41('0x39')]({'view':{'name':_0x2e41('0x27'),'attribute':{'id':/^\w/}},'model':(_0xe76ccd,{writer:_0x6bb1a2})=>_0x6bb1a2['createElement'](_0x2e41('0x56'),{'data-name':'comment:'+_0xe76ccd[_0x2e41('0x42')]('id')})}),_0x589561['conversion'][_0x2e41('0x57')](_0x2e41('0x33'))[_0x2e41('0x1b')]({'view':'comment'});}[_0x2e41('0x37')](){const _0x166b44=this[_0x2e41('0x31')],_0x1fe0b6=_0x166b44[_0x2e41('0xa')]['get'](_0x2e41('0x2')),_0x5a0afd=new Set();_0x166b44['model']['document'][_0x2e41('0x3b')](_0x31c08b=>{let _0x40f9c0=!0x1;for(const [_0x5f4abc,_0x32f6d6]of _0x166b44[_0x2e41('0x5')][_0x2e41('0x18')][_0x2e41('0x4e')][_0x2e41('0x51')]){const {group:_0x54992a,id:_0x3f0a68}=q(_0x5f4abc);let _0xbb1e95=_0x32f6d6['newRange'];if(_0x2e41('0x27')!==_0x54992a||!_0xbb1e95)continue;const _0x22f3f7=_0x2e41('0x9')===_0xbb1e95[_0x2e41('0x29')][_0x2e41('0x3e')];_0x22f3f7||(_0xbb1e95=z(_0xbb1e95,_0x166b44[_0x2e41('0x5')]),!_0xbb1e95||_0xbb1e95[_0x2e41('0x55')](_0x32f6d6[_0x2e41('0xe')]))?!_0xbb1e95||!_0x166b44['model'][_0x2e41('0x2a')](_0xbb1e95)||this[_0x2e41('0x14')][_0x2e41('0x28')](_0x3f0a68)&&_0x22f3f7?(_0x31c08b[_0x2e41('0x47')](_0x5f4abc),_0x40f9c0=!0x0):_0x22f3f7||(this[_0x2e41('0x45')]?_0x5a0afd[_0x2e41('0x35')](_0x3f0a68):this[_0x2e41('0x3')](_0x3f0a68)):(_0x31c08b[_0x2e41('0x46')](_0x5f4abc,{'range':_0xbb1e95}),_0x40f9c0=!0x0);}return _0x40f9c0;}),this['on'](_0x2e41('0x2c'),(_0x5955e2,_0xd38044,_0x5cbe4d)=>{if(!_0x5cbe4d&&_0x5a0afd['size'])for(const _0x4eb69f of _0x5a0afd)this[_0x2e41('0x3')](_0x4eb69f),_0x5a0afd[_0x2e41('0x2b')](_0x4eb69f);}),this[_0x2e41('0x4d')](_0x166b44[_0x2e41('0x5')]['markers'],_0x2e41('0x22'),(_0x5f3ecb,_0x465dfe,_0xf044ea,_0xcc0b06)=>{if(_0xcc0b06)return;const {id:_0x4245ea}=q(_0x465dfe[_0x2e41('0x26')]),_0x31a2a5=_0x166b44['plugins'][_0x2e41('0xb')](_0x2e41('0x2'))[_0x2e41('0x12')](_0x4245ea);_0x5a0afd[_0x2e41('0x2b')](_0x4245ea),_0x31a2a5&&!this[_0x2e41('0x16')](_0x4245ea)&&(this[_0x2e41('0x14')][_0x2e41('0x2b')](_0x4245ea),_0x1fe0b6['_detachCommentThread'](_0x4245ea));});}[_0x2e41('0x3')](_0x3d1804){if(this[_0x2e41('0x14')][_0x2e41('0x28')](_0x3d1804))return;this[_0x2e41('0x14')][_0x2e41('0x35')](_0x3d1804);const _0x12e030=this[_0x2e41('0x31')],_0x3aa2e0=_0x12e030[_0x2e41('0xa')]['get'](_0x2e41('0x2')),_0x1724fd=_0x12e030[_0x2e41('0xf')][_0x2e41('0xb')](_0x2e41('0x8')),_0x5d8ef8=()=>{const _0x423909=this[_0x2e41('0x32')](_0x3d1804);if(0x0==_0x423909['length'])return null;const _0x5a28d6=_0x423909[_0x2e41('0x4b')](_0x264089=>_0x20068c(_0x12e030[_0x2e41('0x7')],_0x264089));return _0x5a28d6[_0x2e41('0x3c')]((_0x47c616,_0x3848ea)=>{const _0x8e2a1=new _0x254e60(_0x47c616),_0x39dc81=new _0x254e60(_0x3848ea),_0x1892f9=_0x8e2a1[_0x2e41('0xd')]-_0x39dc81['top'];return 0x0==_0x1892f9?_0x8e2a1[_0x2e41('0x15')]-_0x39dc81[_0x2e41('0x15')]:_0x1892f9;}),_0x5a28d6[0x0];};!this['getAllMarkersForId'](_0x3d1804)[0x0][_0x2e41('0x41')]?_0x12e030[_0x2e41('0x7')]['view']['once'](_0x2e41('0x10'),()=>{_0x3aa2e0[_0x2e41('0x4a')]({'channelId':_0x1724fd,'threadId':_0x3d1804,'target':_0x5d8ef8});},{'priority':'low'}):_0x3aa2e0[_0x2e41('0x21')]({'channelId':_0x1724fd,'threadId':_0x3d1804})[_0x2e41('0x48')](_0x560d32=>{if('destroyed'!==_0x12e030[_0x2e41('0x17')]){if(_0x560d32)_0x560d32[_0x2e41('0x20')](_0x5d8ef8);else{const _0x4b7cfc=this[_0x2e41('0x32')](_0x3d1804);_0x12e030[_0x2e41('0x5')][_0x2e41('0x49')](_0x376e00=>{for(const _0x2a022e of _0x4b7cfc)_0x376e00[_0x2e41('0x47')](_0x2a022e);});}}});}}function F(_0x357ccf,_0x3ca30c){return _0x3ca30c?_0x357ccf+':'+_0x3ca30c:_0x357ccf;}function q(_0xdf4f6d){const _0x1f3008=_0xdf4f6d[_0x2e41('0x3f')](':');return{'group':_0x1f3008[0x0],'id':_0x1f3008[0x1],'part':_0x1f3008[0x2]};}function z(_0x4578f1,_0x13486a){const _0xd836c0=_0x13486a['schema'],_0x1b80db=_0x13486a[_0x2e41('0x1c')](_0x4578f1[_0x2e41('0x4')]);for(const _0xc491ef of _0x4578f1[_0x2e41('0x38')]()){const {type:_0x5aa97f,item:_0x4f0a7b,nextPosition:_0x1616b3}=_0xc491ef;if(_0x2e41('0x19')===_0x5aa97f||_0xd836c0[_0x2e41('0x0')](_0x4f0a7b)){const _0x3b0a82=_0x13486a['createPositionBefore'](_0x4f0a7b);_0x1b80db[_0x2e41('0x23')]&&(_0x1b80db['start']=_0x3b0a82),_0x1b80db[_0x2e41('0x36')]=_0x1616b3;}}return _0x1b80db[_0x2e41('0x23')]?null:_0x1b80db;}