/*
 *             Copyright (c) 2016 - 2020, CKSource - Frederico Knabben. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import _0x26558c from'@ckeditor/ckeditor5-core/src/plugin';import _0x45baba from'../annotations/annotations';import _0x559dae from'./commentsrepository';import _0x12b80b from'./commentsediting';import _0xc07fa8 from'../annotations/editorannotations';import _0x48de55 from'@ckeditor/ckeditor5-ui/src/button/buttonview';import _0x1d477b from'../../theme/icons/add-comment.svg';export default class e extends _0x26558c{static get['pluginName'](){return'CommentsUI';}static get['requires'](){return[_0x45baba,_0x559dae,_0x12b80b,_0xc07fa8];}['init'](){const _0x2cb861=this['editor'],_0x524ca8=_0x2cb861['plugins']['get']('CommentsRepository'),_0x26d735=_0x2cb861['plugins']['get']('CommentsEditing'),_0x2d55dc=_0x2cb861['plugins']['get']('Annotations'),_0x52b934=_0x2cb861['plugins']['get']('EditorAnnotations');_0x2cb861['ui']['componentFactory']['add']('comment',()=>this['_createUIButton']()),_0x52b934['addSourceCollector'](()=>{const _0x2258e2=[];for(const [_0x451332,_0x32bf16]of _0x524ca8['_threadToController']){const _0xa9d295=_0x26d735['getAllMarkersForId'](_0x451332['id']),_0x4f479b=_0xa9d295['map'](_0x35b9cd=>_0x35b9cd['getRange']());_0xa9d295['length']>0x0&&_0x2258e2['push']([_0x32bf16['view'],_0x4f479b]);}return _0x2258e2;}),this['listenTo'](_0x2d55dc,'change:activeView',(_0x4074a4,_0x358885,_0x5dfcc1)=>{if(!_0x524ca8['_viewToController']['has'](_0x5dfcc1))return void(_0x26d735['activeMarker']=null);const _0x1604c4=_0x524ca8['_viewToController']['get'](_0x5dfcc1)['model']['id'],_0x216159='comment:'+_0x1604c4;_0x26d735['hasMarkerForId'](_0x1604c4)&&_0x26d735['activeMarker']!=_0x216159?_0x26d735['activeMarker']=_0x216159:_0x26d735['activeMarker']&&(_0x26d735['activeMarker']=null);}),this['listenTo'](_0x524ca8,'removeCommentThread',(_0x34c5fa,{threadId:_0x179a81,isFromAdapter:_0x2f2e5b})=>{!_0x2f2e5b&&_0x2cb861['ui']['focusTracker']['isFocused']&&_0x26d735['hasMarkerForId'](_0x179a81)&&_0x2cb861['editing']['view']['focus']();},{'priority':'highest'}),this['listenTo'](_0x524ca8,'addComment',(_0x22add3,{threadId:_0x3a831c,isFromAdapter:_0x3c3237})=>{if(_0x3c3237||!_0x26d735['hasMarkerForId'](_0x3a831c)||!_0x524ca8['hasCommentThread'](_0x3a831c))return;0x1===_0x524ca8['getCommentThread'](_0x3a831c)['length']&&(_0x2cb861['editing']['view']['focus'](),_0x22add3['stop']());},{'priority':'low'});}['_createUIButton'](){const _0x36bed3=this['editor'],_0x2b723c=new _0x48de55(_0x36bed3['locale']),_0xd3b13e=_0x36bed3['commands']['get']('addCommentThread'),{t:t}=this['editor']['locale'];return _0x2b723c['label']=t('Comment'),_0x2b723c['tooltip']=t('Comment'),_0x2b723c['icon']=_0x1d477b,_0x2b723c['bind']('isEnabled')['to'](_0xd3b13e),this['listenTo'](_0x2b723c,'execute',()=>_0xd3b13e['execute']()),_0x2b723c;}}